import{a as kt}from"./chunk-SJUWOT4S.js";import{A as Et,a as bt,b as gt,f as G,g as yt,i as v,m as Ct,o as $,q as vt,r as wt,t as Nt,u as Rt,v as At,w as It,x as Tt,y as St,z as jt}from"./chunk-TYUFTPWB.js";import{Db as ft,S as P,T as M,V as D,_ as mt,ma as ut,na as dt,q as pt,ua as F,va as V,ya as ht}from"./chunk-RVE62PJS.js";import{A as J,Ca as d,Cb as ot,Cc as O,Da as Z,Dc as x,E as K,Fb as R,Ga as p,Gb as A,Gc as _,Ha as tt,Ja as b,Ka as g,La as et,Oa as y,T as z,V as Q,Xa as C,Ya as a,Za as s,_a as S,aa as u,ba as f,bc as rt,ca as X,cc as j,da as m,e as Y,fb as B,gb as it,hc as E,lc as k,o as q,q as N,rb as l,uc as st,vb as nt,vc as at,wc as ct,xc as lt}from"./chunk-UREXVF7E.js";import"./chunk-2HP4JIPC.js";var Pt=new X("Nebular Security Options");var U=i=>Object.assign({},i),Ot=i=>Object.assign([],i),xt=i=>{let t=i.parent;return delete i.parent,t},Mt=(()=>{let t=class t{constructor(e={}){this.settings=e,this.state={},e.accessControl&&this.setAccessControl(e.accessControl)}setAccessControl(e){for(let[n,o]of Object.entries(e)){let r=U(o),c=xt(r);this.register(n,c,r)}}register(e,n=null,o={}){this.validateRole(e),this.state[e]={parent:n};for(let[r,c]of Object.entries(o)){let H=typeof c=="string"?[c]:c;this.allow(e,r,Ot(H))}}allow(e,n,o){this.validateRole(e),this.getRole(e)||this.register(e,null,{}),o=typeof o=="string"?[o]:o;let r=Ot(this.getRoleResources(e,n));r=r.concat(o),this.state[e][n]=r.filter((c,H)=>r.indexOf(c)===H)}can(e,n,o){return this.validateResource(o),this.getRoleParent(e)&&this.can(this.getRoleParent(e),n,o)||this.exactCan(e,n,o)}getRole(e){return this.state[e]}validateRole(e){if(!e)throw new Error("NbAclService: role name cannot be empty")}validateResource(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")}exactCan(e,n,o){let r=this.getRoleResources(e,n);return r.includes(o)||r.includes(t.ANY_RESOURCE)}getRoleResources(e,n){return this.getRoleAbilities(e)[n]||[]}getRoleAbilities(e){let n=U(this.state[e]||{});return xt(U(this.state[e]||{})),n}getRoleParent(e){return this.state[e]?this.state[e].parent:null}};t.ANY_RESOURCE="*",t.\u0275fac=function(n){return new(n||t)(m(Pt,8))},t.\u0275prov=u({token:t,factory:t.\u0275fac});let i=t;return i})(),I=class{};var L=(()=>{let t=class t{constructor(e,n){this.roleProvider=e,this.acl=n}isGranted(e,n){return this.roleProvider.getRole().pipe(N(o=>Array.isArray(o)?o:[o]),N(o=>o.some(r=>this.acl.can(r,e,n))))}};t.\u0275fac=function(n){return new(n||t)(m(I),m(Mt))},t.\u0275prov=u({token:t,factory:t.\u0275fac});let i=t;return i})(),Dt=(()=>{let t=class t{constructor(e,n,o){this.templateRef=e,this.viewContainer=n,this.accessChecker=o,this.destroy$=new Y,this.hasView=!1}set nbIsGranted([e,n]){this.accessChecker.isGranted(e,n).pipe(z(this.destroy$)).subscribe(o=>{o&&!this.hasView?(this.viewContainer.createEmbeddedView(this.templateRef),this.hasView=!0):!o&&this.hasView&&(this.viewContainer.clear(),this.hasView=!1)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};t.\u0275fac=function(n){return new(n||t)(p(Z),p(tt),p(L))},t.\u0275dir=et({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"},standalone:!1});let i=t;return i})(),Ft=(()=>{let t=class t{static forRoot(e){return{ngModule:t,providers:[{provide:Pt,useValue:e},Mt,L]}}};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g({type:t}),t.\u0275inj=f({imports:[k]});let i=t;return i})();var W=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=b({type:t,selectors:[["nb-playground-auth"]],standalone:!1,decls:1,vars:0,template:function(n,o){n&1&&S(0,"router-outlet")},dependencies:[O],encapsulation:2});let i=t;return i})();var Yt=()=>["create","comments"];function qt(i,t){i&1&&(a(0,"button"),l(1,"Post Comment"),s())}function Jt(i,t){i&1&&(a(0,"button"),l(1,"Post Comment"),s())}var Gt=(()=>{let t=class t{constructor(e){this.accessChecker=e}};t.\u0275fac=function(n){return new(n||t)(p(L))},t.\u0275cmp=b({type:t,selectors:[["nb-actions-test"]],standalone:!1,decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(n,o){n&1&&(a(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card")(3,"nb-card-header"),l(4,"Service usage"),s(),a(5,"nb-card-body"),y(6,qt,2,0,"button",0),R(7,"async"),s()(),a(8,"nb-card")(9,"nb-card-header"),l(10,"Directive usage"),s(),a(11,"nb-card-body"),y(12,Jt,2,0,"button",1),s()()()()),n&2&&(d(6),C("ngIf",A(7,2,o.accessChecker.isGranted("create","comments"))),d(6),C("nbIsGranted",ot(4,Yt)))},dependencies:[j,D,M,P,F,V,Dt,E],encapsulation:2});let i=t;return i})();var T=(()=>{let t=class t{constructor(e,n){this.authService=e,this.router=n}canActivate(){return this.authService.isAuthenticated().pipe(Q(e=>{e||this.router.navigate(["auth/login"])}))}};t.\u0275fac=function(n){return new(n||t)(m(v),m(x))},t.\u0275prov=u({token:t,factory:t.\u0275fac});let i=t;return i})();function Kt(i,t){if(i&1&&(a(0,"nb-list-item"),l(1),s()),i&2){let w=t.$implicit;d(),nt(" ",w.region,", ",w.name," (",w.year,") ")}}function zt(i,t){if(i&1&&(a(0,"nb-card")(1,"nb-card-header"),l(2," Alain'wines "),s(),a(3,"nb-list"),y(4,Kt,2,3,"nb-list-item",2),R(5,"async"),s()()),i&2){let w=it();d(4),C("ngForOf",A(5,1,w.wines$))}}var Ht=(()=>{let t=class t{constructor(e,n,o,r={}){this.authService=e,this.http=n,this.router=o,this.options=r,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(c=>{this.token=null,c&&c.isValid()&&(this.token=c)})}logout(){this.authService.logout(this.strategy).pipe(K(this.redirectDelay)).subscribe(e=>this.router.navigate(["/auth/login"]))}loadWines(){this.wines$=this.http.get("http://localhost:4400/api/wines").pipe(J(e=>(e instanceof st&&e.status===401&&this.router.navigate(["/auth/login"]),q([]))))}getConfigValue(e){return kt(this.options,e,null)}};t.\u0275fac=function(n){return new(n||t)(p(v),p(at),p(x),p(bt))},t.\u0275cmp=b({type:t,selectors:[["nb-playground-api-calls"]],standalone:!1,decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(n,o){if(n&1&&(S(0,"router-outlet"),a(1,"nb-layout")(2,"nb-layout-column")(3,"nb-card")(4,"nb-card-body")(5,"h2"),l(6,"You are authenticated"),s(),a(7,"p"),l(8,"You can call the secured API"),s(),a(9,"button",0),B("click",function(){return o.loadWines()}),l(10,"Call API"),s(),a(11,"button",0),B("click",function(){return o.logout()}),l(12,"Sign out"),s()()(),y(13,zt,6,3,"nb-card",1),R(14,"async"),s()()),n&2){let r;d(13),C("ngIf",(r=A(14,1,o.wines$))==null?null:r.length)}},dependencies:[rt,j,O,D,M,P,F,V,ut,dt,E],encapsulation:2});let i=t;return i})();var Qt=[{path:"",component:W,children:[{path:"",component:Nt,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:Rt},{path:"register",component:At},{path:"logout",component:It},{path:"request-password",component:Tt},{path:"reset-password",component:St}]}]},{path:"acl/acl-test.component",component:Gt},{path:"auth-guard.service",canActivate:[T],component:W},{path:"api-calls.component",canActivate:[T],component:Ht}],Bt=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g({type:t}),t.\u0275inj=f({imports:[_.forChild(Qt),_]});let i=t;return i})();var _t=(()=>{let t=class t{constructor(e){this.authService=e}getRole(){return this.authService.onTokenChange().pipe(N(e=>e instanceof G&&e.isValid()?e.getPayload().role:"guest"))}};t.\u0275fac=function(n){return new(n||t)(m(v))},t.\u0275prov=u({token:t,factory:t.\u0275fac});let i=t;return i})();function Xt(i){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(t=>i.url.includes(t))}var We=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g({type:t}),t.\u0275inj=f({providers:[T,{provide:ct,useClass:Et,multi:!0},{provide:gt,useValue:Xt},{provide:I,useClass:_t}],imports:[k,pt,lt,Bt,mt,ht,ft,jt.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[Ct.setup({name:"dummy",alwaysFail:!0,delay:1e3}),wt.setup({name:"email",token:{class:G},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),vt.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:$.PASSWORD,class:yt},refresh:{endpoint:"refresh-token",grantType:$.REFRESH_TOKEN}})]}),Ft.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]});let i=t;return i})();export{We as AuthPlaygroundModule,Xt as filterInterceptorRequest};
