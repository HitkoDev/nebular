import{a as Nt,b as B,c as wt,f as G,g as Rt,i as h,m as It,o as W,q as Tt,r as At,t as St,u as jt,v as Et,w as Ot,x as kt,y as xt,z as Pt}from"./chunk-OIFSN6AI.js";import{Ba as V,Ca as _,Fa as yt,G as dt,Kb as vt,Z as F,_ as M,aa as D,fa as bt,ta as gt,ua as Ct}from"./chunk-NKUATUXO.js";import{A as Z,Ac as ut,Bb as ct,Bc as ft,Cc as ht,F as q,Hc as x,Ia as d,Ib as lt,Ic as P,Ja as rt,Lb as T,Lc as K,Ma as m,Mb as A,Na as nt,Pa as g,Qa as C,Ra as st,T as $,Ua as y,V as tt,X as et,bb as v,ca as f,cb as a,da as b,db as s,e as Q,ea as it,eb as j,fa as l,hc as pt,ic as E,lb as Y,ma as ot,mb as at,nc as O,o as X,q as I,qc as k,xb as p,zc as mt}from"./chunk-ZL7LBTKX.js";import"./chunk-2HP4JIPC.js";var Ft=(()=>{let t=class t{constructor(e,o){this.injector=e,this.filter=o}intercept(e,o){return this.filter(e)?o.handle(e):this.authService.isAuthenticatedOrRefresh().pipe($(r=>r?this.authService.getToken().pipe($(n=>{let c=`Bearer ${n.getValue()}`;return e=e.clone({setHeaders:{Authorization:c}}),o.handle(e)})):o.handle(e)))}get authService(){return this.injector.get(h)}};t.\u0275fac=function(o){return new(o||t)(l(ot),l(B))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let i=t;return i})();var L=new it("Nebular Security Options");var J=i=>Object.assign({},i),Mt=i=>Object.assign([],i),Dt=i=>{let t=i.parent;return delete i.parent,t},H=(()=>{let t=class t{constructor(e={}){this.settings=e,this.state={},e.accessControl&&this.setAccessControl(e.accessControl)}setAccessControl(e){for(let[o,r]of Object.entries(e)){let n=J(r),c=Dt(n);this.register(o,c,n)}}register(e,o=null,r={}){this.validateRole(e),this.state[e]={parent:o};for(let[n,c]of Object.entries(r)){let U=typeof c=="string"?[c]:c;this.allow(e,n,Mt(U))}}allow(e,o,r){this.validateRole(e),this.getRole(e)||this.register(e,null,{}),r=typeof r=="string"?[r]:r;let n=Mt(this.getRoleResources(e,o));n=n.concat(r),this.state[e][o]=n.filter((c,U)=>n.indexOf(c)===U)}can(e,o,r){return this.validateResource(r),this.getRoleParent(e)&&this.can(this.getRoleParent(e),o,r)||this.exactCan(e,o,r)}getRole(e){return this.state[e]}validateRole(e){if(!e)throw new Error("NbAclService: role name cannot be empty")}validateResource(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")}exactCan(e,o,r){let n=this.getRoleResources(e,o);return n.includes(r)||n.includes(t.ANY_RESOURCE)}getRoleResources(e,o){return this.getRoleAbilities(e)[o]||[]}getRoleAbilities(e){let o=J(this.state[e]||{});return Dt(J(this.state[e]||{})),o}getRoleParent(e){return this.state[e]?this.state[e].parent:null}};t.ANY_RESOURCE="*",t.\u0275fac=function(o){return new(o||t)(l(L,8))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let i=t;return i})();var N=class{};var w=(()=>{let t=class t{constructor(e,o){this.roleProvider=e,this.acl=o}isGranted(e,o){return this.roleProvider.getRole().pipe(I(r=>Array.isArray(r)?r:[r]),I(r=>r.some(n=>this.acl.can(n,e,o))))}};t.\u0275fac=function(o){return new(o||t)(l(N),l(H))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let i=t;return i})();var Vt=(()=>{let t=class t{constructor(e,o,r){this.templateRef=e,this.viewContainer=o,this.accessChecker=r,this.destroy$=new Q,this.hasView=!1}set nbIsGranted([e,o]){this.accessChecker.isGranted(e,o).pipe(tt(this.destroy$)).subscribe(r=>{r&&!this.hasView?(this.viewContainer.createEmbeddedView(this.templateRef),this.hasView=!0):!r&&this.hasView&&(this.viewContainer.clear(),this.hasView=!1)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};t.\u0275fac=function(o){return new(o||t)(m(rt),m(nt),m(w))},t.\u0275dir=st({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"},standalone:!1});let i=t;return i})();var _t=(()=>{let t=class t{static forRoot(e){return{ngModule:t,providers:[{provide:L,useValue:e},H,w]}}};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=C({type:t}),t.\u0275inj=b({imports:[k]});let i=t;return i})();var z=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=g({type:t,selectors:[["nb-playground-auth"]],standalone:!1,decls:1,vars:0,template:function(o,r){o&1&&j(0,"router-outlet")},dependencies:[x],encapsulation:2});let i=t;return i})();var Zt=()=>["create","comments"];function qt(i,t){i&1&&(a(0,"button"),p(1,"Post Comment"),s())}function te(i,t){i&1&&(a(0,"button"),p(1,"Post Comment"),s())}var Gt=(()=>{let t=class t{constructor(e){this.accessChecker=e}};t.\u0275fac=function(o){return new(o||t)(m(w))},t.\u0275cmp=g({type:t,selectors:[["nb-actions-test"]],standalone:!1,decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(o,r){o&1&&(a(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card")(3,"nb-card-header"),p(4,"Service usage"),s(),a(5,"nb-card-body"),y(6,qt,2,0,"button",0),T(7,"async"),s()(),a(8,"nb-card")(9,"nb-card-header"),p(10,"Directive usage"),s(),a(11,"nb-card-body"),y(12,te,2,0,"button",1),s()()()()),o&2&&(d(6),v("ngIf",A(7,2,r.accessChecker.isGranted("create","comments"))),d(6),v("nbIsGranted",lt(4,Zt)))},dependencies:[E,D,M,F,V,_,Vt,O],encapsulation:2});let i=t;return i})();var S=(()=>{let t=class t{constructor(e,o){this.authService=e,this.router=o}canActivate(){return this.authService.isAuthenticated().pipe(et(e=>{e||this.router.navigate(["auth/login"])}))}};t.\u0275fac=function(o){return new(o||t)(l(h),l(P))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let i=t;return i})();function ee(i,t){if(i&1&&(a(0,"nb-list-item"),p(1),s()),i&2){let R=t.$implicit;d(),ct(" ",R.region,", ",R.name," (",R.year,") ")}}function ie(i,t){if(i&1&&(a(0,"nb-card")(1,"nb-card-header"),p(2," Alain'wines "),s(),a(3,"nb-list"),y(4,ee,2,3,"nb-list-item",2),T(5,"async"),s()()),i&2){let R=at();d(4),v("ngForOf",A(5,1,R.wines$))}}var Ht=(()=>{let t=class t{constructor(e,o,r,n={}){this.authService=e,this.http=o,this.router=r,this.options=n,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(c=>{this.token=null,c&&c.isValid()&&(this.token=c)})}logout(){this.authService.logout(this.strategy).pipe(q(this.redirectDelay)).subscribe(e=>this.router.navigate(["/auth/login"]))}loadWines(){this.wines$=this.http.get("http://localhost:4400/api/wines").pipe(Z(e=>(e instanceof mt&&e.status===401&&this.router.navigate(["/auth/login"]),X([]))))}getConfigValue(e){return wt(this.options,e,null)}};t.\u0275fac=function(o){return new(o||t)(m(h),m(ut),m(P),m(Nt))},t.\u0275cmp=g({type:t,selectors:[["nb-playground-api-calls"]],standalone:!1,decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(o,r){if(o&1&&(j(0,"router-outlet"),a(1,"nb-layout")(2,"nb-layout-column")(3,"nb-card")(4,"nb-card-body")(5,"h2"),p(6,"You are authenticated"),s(),a(7,"p"),p(8,"You can call the secured API"),s(),a(9,"button",0),Y("click",function(){return r.loadWines()}),p(10,"Call API"),s(),a(11,"button",0),Y("click",function(){return r.logout()}),p(12,"Sign out"),s()()(),y(13,ie,6,3,"nb-card",1),T(14,"async"),s()()),o&2){let n;d(13),v("ngIf",(n=A(14,1,r.wines$))==null?null:n.length)}},dependencies:[pt,E,x,D,M,F,V,_,gt,Ct,O],encapsulation:2});let i=t;return i})();var oe=[{path:"",component:z,children:[{path:"",component:St,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:jt},{path:"register",component:Et},{path:"logout",component:Ot},{path:"request-password",component:kt},{path:"reset-password",component:xt}]}]},{path:"acl/acl-test.component",component:Gt},{path:"auth-guard.service",canActivate:[S],component:z},{path:"api-calls.component",canActivate:[S],component:Ht}],Ut=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=C({type:t}),t.\u0275inj=b({imports:[K.forChild(oe),K]});let i=t;return i})();var $t=(()=>{let t=class t{constructor(e){this.authService=e}getRole(){return this.authService.onTokenChange().pipe(I(e=>e instanceof G&&e.isValid()?e.getPayload().role:"guest"))}};t.\u0275fac=function(o){return new(o||t)(l(h))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let i=t;return i})();function re(i){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(t=>i.url.includes(t))}var ri=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=C({type:t}),t.\u0275inj=b({providers:[S,{provide:ft,useClass:Ft,multi:!0},{provide:B,useValue:re},{provide:N,useClass:$t}],imports:[k,dt,ht,Ut,bt,yt,vt,Pt.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[It.setup({name:"dummy",alwaysFail:!0,delay:1e3}),At.setup({name:"email",token:{class:G},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),Tt.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:W.PASSWORD,class:Rt},refresh:{endpoint:"refresh-token",grantType:W.REFRESH_TOKEN}})]}),_t.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]});let i=t;return i})();export{ri as AuthPlaygroundModule,re as filterInterceptorRequest};
